@using BlazorFocused
@using BlazorMusic.Client.Actions
@using BlazorMusic.Client.Models
@using BlazorMusic.Shared

@inject IStore<ArtistStore> store

@if (artist is not null)
{
    <h1>@artist.Name</h1>

    <ul class="nav nav-tabs">
        <li class="nav-item">
            <a class="nav-link @IsCurrentTab("Overview")" href="#" @onclick="@(() => ChangeTab("Overview"))">Overview</a>
        </li>
        <li class="nav-item">
            <a class="nav-link @IsCurrentTab("Releases")" href="#" @onclick="@(() => ChangeTab("Releases"))">Releases</a>
        </li>
        <li class="nav-item">
            <a class="nav-link @IsCurrentTab("Histogram")" href="#" @onclick="@(() => ChangeTab("Histogram"))">Histogram</a>
        </li>
    </ul>

    @switch(currentTab)
    {
        case "Overview":
            <table cellpadding="5">
                <tr><td align="right">Category:</td><td>@artist.Type</td></tr>
                <tr><td align="right">Desctiption:</td><td>@artist.Description</td></tr>
                <tr><td align="right">Country:</td><td>@artist.Country</td></tr>
                <tr><td align="right">Search Rank:</td><td>@artist.Rank</td></tr>
                <tr><td align="right">Tags:</td><td> @ShowArtistTags()</td></tr>
            </table>
            break;
        case "Releases":
            break;
        case "Histogram":
            <HistogramChart Id="artistMusicHistogram" 
                Years="@(new[] { 2019, 2020, 2021, 2022 })"
                ReleaseCount="@(new[] { 3, 2, 5, 0 })" />
            break;
        default:
            break;
    }
}
else
{
    <h3>ArtistDetails</h3>

    <div class="">No artist has been selected</div>
}

@code {
    private Artist artist = null;
    private string currentTab = "Overview";

    protected override void OnInitialized()
    {
        store.Subscribe(store =>
        {
            artist = store.CurrentArtist;

            StateHasChanged();
        });
    }

    private string IsCurrentTab(string tabName) =>
        currentTab == tabName ? "active" : string.Empty;

    private void ChangeTab(string tabName)
    {
        currentTab = tabName;

        StateHasChanged();
    }

    private string ShowArtistTags() =>
        artist.Tags is not null ?
            string.Join(", ", artist.Tags) : "N/A";
}
